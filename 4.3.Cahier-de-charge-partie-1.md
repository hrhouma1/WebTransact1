--------------------------------
# 1 - Rappel des deux classes **Customer** et **Card** avec les relations de clé primaire (PK) et clé étrangère (FK) :
--------------------------------


```
+--------------------------+             +--------------------------+
|        Customer           |             |          Card             |
+--------------------------+             +--------------------------+
| - customerId (PK)         | <-----------| - cardId (PK)             |
| - customerFirstName       |             | - customerId (FK)         |
| - customerLastName        |             | - cardNumber              |
+--------------------------+             | - cardType                |
                                          | - totalLimit              |
                                          | - amountUsed              |
                                          | - availableAmount         |
                                          | - createDt                |
                                          +--------------------------+
```

- **Customer** : La classe `Customer` contient `customerId` comme clé primaire (PK).
- **Card** : La classe `Card` contient `cardId` comme clé primaire (PK) et `customerId` comme clé étrangère (FK) qui fait référence à `Customer`.

- Relation entre un client et ses cartes, où un client peut avoir plusieurs cartes.



--------------------------------




# Scénarios de test pour l'API Clients et Cartes

## Scénario 1: Gestion des clients

### 1.1 Ajouter un premier client (ID attendu: 1)
```http
POST http://localhost:8080/api/v1/customers/add
Content-Type: application/json

{
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```
Réponse attendue:
```json
{
  "customerId": 1,
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```

### 1.2 Ajouter un deuxième client (ID attendu: 2)
```http
POST http://localhost:8080/api/v1/customers/add
Content-Type: application/json

{
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```
Réponse attendue:
```json
{
  "customerId": 2,
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```

### 1.3 Afficher tous les clients (2 clients attendus)
```http
GET http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
[
  {
    "customerId": 1,
    "customerFirstName": "John",
    "customerLastName": "Doe"
  },
  {
    "customerId": 2,
    "customerFirstName": "Jane",
    "customerLastName": "Smith"
  }
]
```

### 1.4 Modifier le client avec l'ID 2
```http
PUT http://localhost:8080/api/v1/customers/update/2
Content-Type: application/json

{   
  "customerFirstName": "Jane Updated",
  "customerLastName": "Smith Modified"
}
```
Réponse attendue:
```json
{
  "customerId": 2,
  "customerFirstName": "Jane Updated",
  "customerLastName": "Smith Modified"
}
```

## Scénario 2: Gestion des cartes

### 2.1 Ajouter une carte au client 1 (ID de carte attendu: 1)
```http
POST http://localhost:8080/api/v1/cards/add
Content-Type: application/json

{
  "customerId": 1,
  "cardNumber": "1234567890123456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```
Réponse attendue:
```json
{
  "cardId": 1,
  "customerId": 1,
  "cardNumber": "1234567890123456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```

### 2.2 Ajouter une carte au client 2 (ID de carte attendu: 2)
```http
POST http://localhost:8080/api/v1/cards/add
Content-Type: application/json

{
  "customerId": 2,
  "cardNumber": "9876543210987654",
  "cardType": "MasterCard",
  "totalLimit": 10000,
  "amountUsed": 2000,
  "availableAmount": 8000,
  "createDt": "2024-09-30"
}
```
Réponse attendue:
```json
{
  "cardId": 2,
  "customerId": 2,
  "cardNumber": "9876543210987654",
  "cardType": "MasterCard",
  "totalLimit": 10000,
  "amountUsed": 2000,
  "availableAmount": 8000,
  "createDt": "2024-09-30"
}
```

### 2.3 Afficher toutes les cartes (2 cartes attendues)
```http
GET http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
[
  {
    "cardId": 1,
    "customerId": 1,
    "cardNumber": "1234567890123456",
    "cardType": "Visa",
    "totalLimit": 5000,
    "amountUsed": 1000,
    "availableAmount": 4000,
    "createDt": "2024-09-30"
  },
  {
    "cardId": 2,
    "customerId": 2,
    "cardNumber": "9876543210987654",
    "cardType": "MasterCard",
    "totalLimit": 10000,
    "amountUsed": 2000,
    "availableAmount": 8000,
    "createDt": "2024-09-30"
  }
]
```

## Scénario 3 : Gestion des suppressions et des contraintes

### 3.1 Tenter de supprimer le client 1 qui a une carte (devrait échouer)
```http
DELETE http://localhost:8080/api/v1/customers/delete/1
```
Réponse attendue:
```json
{
  "error": "Cannot delete customer with associated cards"
}
```

### 3.2 Supprimer la carte du client 1 par ID de carte
```http
DELETE http://localhost:8080/api/v1/cards/delete/1
```
Réponse attendue:
```json
{
  "message": "Card with ID 1 successfully deleted"
}
```

### 3.3 Vérifier la suppression de la carte (devrait retourner 404)
```http
GET http://localhost:8080/api/v1/cards/1
```
Réponse attendue:
```json
{
  "error": "Card not found"
}
```

### 3.4 Supprimer le client 1 (devrait réussir maintenant)
```http
DELETE http://localhost:8080/api/v1/customers/delete/1
```
Réponse attendue:
```json
{
  "message": "Customer with ID 1 successfully deleted"
}
```

## Scénario 4 : Nettoyage final et vérifications

### 4.1 Afficher tous les clients restants (1 client attendu)
```http
GET http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
[
  {
    "customerId": 2,
    "customerFirstName": "Jane Updated",
    "customerLastName": "Smith Modified"
  }
]
```

### 4.2 Afficher toutes les cartes restantes (1 carte attendue)
```http
GET http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
[
  {
    "cardId": 2,
    "customerId": 2,
    "cardNumber": "9876543210987654",
    "cardType": "MasterCard",
    "totalLimit": 10000,
    "amountUsed": 2000,
    "availableAmount": 8000,
    "createDt": "2024-09-30"
  }
]
```

### 4.3 Supprimer toutes les cartes
```http
DELETE http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
{
  "message": "All cards successfully deleted"
}
```

### 4.4 Supprimer tous les clients
```http
DELETE http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
{
  "message": "All customers successfully deleted"
}
```

### 4.5 Vérifier que tous les clients sont supprimés
```http
GET http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
[]
```

### 4.6 Vérifier que toutes les cartes sont supprimées
```http
GET http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
[]
```
```



--------------------------------


























-------------------------------------------------
# 2 - Contraintes d'intégrité :
-------------------------------------------------



# Opérations CRUD pour Customer

| Opération | Point de terminaison | Contrainte | Corps de requête | Auto-incrément | Description |
|-----------|----------------------|------------|------------------|----------------|-------------|
| Create | POST /customers/add | N/A | Oui | ✓ | Ajoute un nouveau client |
| Read (Single) | GET /customers/{id} | ID valide | Non | N/A | Récupère les détails d'un client |
| Read (All) | GET /customers | N/A | Non | N/A | Récupère tous les clients |
| Update | PUT /customers/update/{id} | ID valide | Oui | N/A | Met à jour les informations d'un client |
| Delete (Single) | DELETE /customers/delete/{id} | Pas de cartes associées | Non | N/A | Supprime un client sans cartes |
| Delete (All) | DELETE /customers | N/A | Non | N/A | Supprime tous les clients |

### Exemples de corps de requête pour Customer

**Create Customer**
```json
{
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```

**Update Customer**
```json
{
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```

# Opérations CRUD pour Card

| Opération | Point de terminaison | Contrainte | Corps de requête | Auto-incrément | Description |
|-----------|----------------------|------------|------------------|----------------|-------------|
| Create | POST /cards/add | Client existant | Oui | ✓ | Ajoute une nouvelle carte |
| Read (Single by ID) | GET /cards/{id} | ID valide | Non | N/A | Récupère les détails d'une carte par ID |
| Read (Single by Number) | GET /cards/number/{cardNumber} | Numéro de carte valide | Non | N/A | Récupère les détails d'une carte par numéro |
| Read (All) | GET /cards | N/A | Non | N/A | Récupère toutes les cartes |
| Update | PUT /cards/update/{id} | ID valide, client existant | Oui | N/A | Met à jour les détails d'une carte |
| Delete (Single by ID) | DELETE /cards/delete/{id} | ID valide | Non | N/A | Supprime une carte par son ID |
| Delete (Single by Number) | DELETE /cards/delete/number/{cardNumber} | Numéro de carte valide | Non | N/A | Supprime une carte par son numéro |
| Delete (All) | DELETE /cards | N/A | Non | N/A | Supprime toutes les cartes |

# Exemples de corps de requête pour Card

**Create Card**
```json
{
  "customerId": 1,
  "cardNumber": "1234-5678-9012-3456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```

**Update Card**
```json
{
  "cardNumber": "1111-2222-3333-4444",
  "cardType": "MasterCard",
  "totalLimit": 6000,
  "amountUsed": 2000,
  "availableAmount": 4000
}
```

# Contraintes d'intégrité supplémentaires

- **Intégrité référentielle** : La `customerId` dans la table `Card` doit correspondre à un client existant dans la table `Customer`.
- **Unicité** : Le numéro de carte (`cardNumber`) doit être unique pour chaque carte.
- **Validation des données** :
  - Les montants (`totalLimit`, `amountUsed`, `availableAmount`) doivent être positifs.
  - `availableAmount` doit être égal à `totalLimit` moins `amountUsed`.
- **Gestion des erreurs** :
  - Retourner 404 pour les ID ou numéros de carte invalides.
  - Retourner 400 pour les erreurs de validation.
- **Suppression en cascade** (optionnel) : Possibilité de supprimer un client et toutes ses cartes associées.
- **Suppression de tous les clients/cartes** : Ces opérations doivent être utilisées avec précaution et peuvent nécessiter une confirmation supplémentaire.





