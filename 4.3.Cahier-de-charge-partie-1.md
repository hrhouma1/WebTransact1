--------------------------------
# 1 - Rappel des deux classes **Customer** et **Card** avec les relations de clé primaire (PK) et clé étrangère (FK) :
--------------------------------

## Relation entre un client et ses cartes, où un client peut avoir plusieurs cartes.

```
+--------------------------+             +--------------------------+
|        Customer           |             |          Card             |
+--------------------------+             +--------------------------+
| - customerId (PK)         | <-----------| - cardId (PK)             |
| - customerFirstName       |             | - customerId (FK)         |
| - customerLastName        |             | - cardNumber              |
+--------------------------+             | - cardType                |
                                          | - totalLimit              |
                                          | - amountUsed              |
                                          | - availableAmount         |
                                          | - createDt                |
                                          +--------------------------+
```

- **Customer** : La classe `Customer` contient `customerId` comme clé primaire (PK).
- **Card** : La classe `Card` contient `cardId` comme clé primaire (PK) et `customerId` comme clé étrangère (FK) qui fait référence à `Customer`.




------------------------------------
#  1 - Cahier de charge 
-------------------------------------

## ***Veuillez consulter le cahier des charges détaillant les scénarios de test pour l'API Clients et Cartes.***

# Scénario 1: Gestion des clients (Customer)

### 1.1 Create: Ajouter un premier client
```http
POST http://localhost:8080/api/v1/customers/add
Content-Type: application/json

{
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```
Réponse attendue:
```json
{
  "customerId": 1,
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```
(Nombre de clients: 1, Cartes par client: {1: 0})

### 1.2 Create: Ajouter un deuxième client
```http
POST http://localhost:8080/api/v1/customers/add
Content-Type: application/json

{
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```
Réponse attendue:
```json
{
  "customerId": 2,
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```
(Nombre de clients: 2, Cartes par client: {1: 0, 2: 0})

### 1.3 Read (All): Afficher tous les clients
```http
GET http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
[
  {
    "customerId": 1,
    "customerFirstName": "John",
    "customerLastName": "Doe"
  },
  {
    "customerId": 2,
    "customerFirstName": "Jane",
    "customerLastName": "Smith"
  }
]
```
(Nombre de clients: 2, Cartes par client: {1: 0, 2: 0})

# Scénario 2: Gestion des cartes (Card)

### 2.1 Create: Ajouter une carte au client 1
```http
POST http://localhost:8080/api/v1/cards/add
Content-Type: application/json

{
  "customerId": 1,
  "cardNumber": "1234-5678-9012-3456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```
Réponse attendue:
```json
{
  "cardId": 1,
  "customerId": 1,
  "cardNumber": "1234-5678-9012-3456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```
(Nombre de clients: 2, Cartes par client: {1: 1, 2: 0})

### 2.2 Create: Ajouter une carte au client 2
```http
POST http://localhost:8080/api/v1/cards/add
Content-Type: application/json

{
  "customerId": 2,
  "cardNumber": "9876-5432-1098-7654",
  "cardType": "MasterCard",
  "totalLimit": 10000,
  "amountUsed": 2000,
  "availableAmount": 8000,
  "createDt": "2024-09-30"
}
```
Réponse attendue:
```json
{
  "cardId": 2,
  "customerId": 2,
  "cardNumber": "9876-5432-1098-7654",
  "cardType": "MasterCard",
  "totalLimit": 10000,
  "amountUsed": 2000,
  "availableAmount": 8000,
  "createDt": "2024-09-30"
}
```
(Nombre de clients: 2, Cartes par client: {1: 1, 2: 1})

# Scénario 3: Gestion des suppressions et des contraintes

### 3.1 Delete (Single Customer): Tenter de supprimer le client 1 qui a une carte (devrait échouer)
```http
DELETE http://localhost:8080/api/v1/customers/delete/1
```
Réponse attendue:
```json
{
  "error": "Cannot delete customer with associated cards"
}
```
(Nombre de clients: 2, Cartes par client: {1: 1, 2: 1})

### 3.2 Delete (Single Card by ID): Supprimer la carte du client 1
```http
DELETE http://localhost:8080/api/v1/cards/delete/1
```
Réponse attendue:
```json
{
  "message": "Card with ID 1 successfully deleted"
}
```
(Nombre de clients: 2, Cartes par client: {1: 0, 2: 1})

### 3.3 Delete (Single Customer): Supprimer le client 1 (devrait réussir maintenant)
```http
DELETE http://localhost:8080/api/v1/customers/delete/1
```
Réponse attendue:
```json
{
  "message": "Customer with ID 1 successfully deleted"
}
```
(Nombre de clients: 1, Cartes par client: {2: 1})

# Scénario 4: Préparation pour la suppression finale

### 4.1 Create: Ajouter un nouveau client
```http
POST http://localhost:8080/api/v1/customers/add
Content-Type: application/json

{
  "customerFirstName": "Alice",
  "customerLastName": "Johnson"
}
```
Réponse attendue:
```json
{
  "customerId": 3,
  "customerFirstName": "Alice",
  "customerLastName": "Johnson"
}
```
(Nombre de clients: 2, Cartes par client: {2: 1, 3: 0})

### 4.2 Create: Ajouter une carte au nouveau client
```http
POST http://localhost:8080/api/v1/cards/add
Content-Type: application/json

{
  "customerId": 3,
  "cardNumber": "1111-2222-3333-4444",
  "cardType": "Amex",
  "totalLimit": 15000,
  "amountUsed": 5000,
  "availableAmount": 10000,
  "createDt": "2024-09-30"
}
```
Réponse attendue:
```json
{
  "cardId": 3,
  "customerId": 3,
  "cardNumber": "1111-2222-3333-4444",
  "cardType": "Amex",
  "totalLimit": 15000,
  "amountUsed": 5000,
  "availableAmount": 10000,
  "createDt": "2024-09-30"
}
```
(Nombre de clients: 2, Cartes par client: {2: 1, 3: 1})

# Scénario 5: Nettoyage final et vérifications

### 5.1 Delete (All Cards): Supprimer toutes les cartes
```http
DELETE http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
{
  "message": "All cards successfully deleted"
}
```
(Nombre de clients: 2, Cartes par client: {2: 0, 3: 0})

### 5.2 Delete (All Customers): Supprimer tous les clients
```http
DELETE http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
{
  "message": "All customers successfully deleted"
}
```
(Nombre de clients: 0, Cartes par client: {})

### 5.3 Read (All Customers): Vérifier que tous les clients sont supprimés
```http
GET http://localhost:8080/api/v1/customers
```
Réponse attendue:
```json
[]
```
(Nombre de clients: 0, Cartes par client: {})

### 5.4 Read (All Cards): Vérifier que toutes les cartes sont supprimées
```http
GET http://localhost:8080/api/v1/cards
```
Réponse attendue:
```json
[]
```
(Nombre de clients: 0, Cartes par client: {})





------------------------------------------------------
# 2 - Opérations CRUD pour Customer
------------------------------------------------------


| Opération | Point de terminaison | Contrainte | Corps de requête | Auto-incrément | Description |
|-----------|----------------------|------------|------------------|----------------|-------------|
| Create | POST /api/v1/customers/add | N/A | Oui | ✓ | Ajoute un nouveau client |
| Read (Single) | GET /api/v1/customers/{id} | ID valide | Non | N/A | Récupère les détails d'un client |
| Read (All) | GET /api/v1/customers | N/A | Non | N/A | Récupère tous les clients |
| Update | PUT /api/v1/customers/update/{id} | ID valide | Oui | N/A | Met à jour les informations d'un client |
| Delete (Single) | DELETE /api/v1/customers/delete/{id} | Pas de cartes associées | Non | N/A | Supprime un client sans cartes |
| Delete (All) | DELETE /api/v1/customers | N/A | Non | N/A | Supprime tous les clients |

### Exemples de corps de requête pour Customer

**Create Customer**
```json
{
  "customerFirstName": "John",
  "customerLastName": "Doe"
}
```

**Update Customer**
```json
{
  "customerFirstName": "Jane",
  "customerLastName": "Smith"
}
```

# Opérations CRUD pour Card

| Opération | Point de terminaison | Contrainte | Corps de requête | Auto-incrément | Description |
|-----------|----------------------|------------|------------------|----------------|-------------|
| Create | POST /api/v1/cards/add | Client existant | Oui | ✓ | Ajoute une nouvelle carte |
| Read (Single by ID) | GET /api/v1/cards/{id} | ID valide | Non | N/A | Récupère les détails d'une carte par ID |
| Read (Single by Number) | GET /api/v1/cards/number/{cardNumber} | Numéro de carte valide | Non | N/A | Récupère les détails d'une carte par numéro |
| Read (All) | GET /api/v1/cards | N/A | Non | N/A | Récupère toutes les cartes |
| Update | PUT /api/v1/cards/update/{id} | ID valide, client existant | Oui | N/A | Met à jour les détails d'une carte |
| Delete (Single by ID) | DELETE /api/v1/cards/delete/{id} | ID valide | Non | N/A | Supprime une carte par son ID |
| Delete (Single by Number) | DELETE /api/v1/cards/delete/number/{cardNumber} | Numéro de carte valide | Non | N/A | Supprime une carte par son numéro |
| Delete (All) | DELETE /api/v1/cards | N/A | Non | N/A | Supprime toutes les cartes |

### Exemples de corps de requête pour Card

**Create Card**
```json
{
  "customerId": 1,
  "cardNumber": "1234-5678-9012-3456",
  "cardType": "Visa",
  "totalLimit": 5000,
  "amountUsed": 1000,
  "availableAmount": 4000,
  "createDt": "2024-09-30"
}
```

**Update Card**
```json
{
  "cardNumber": "1111-2222-3333-4444",
  "cardType": "MasterCard",
  "totalLimit": 6000,
  "amountUsed": 2000,
  "availableAmount": 4000
}
```

# Contraintes d'intégrité supplémentaires

- **Intégrité référentielle** : La `customerId` dans la table `Card` doit correspondre à un client existant dans la table `Customer`.
- **Unicité** : Le numéro de carte (`cardNumber`) doit être unique pour chaque carte.
- **Validation des données** :
  - Les montants (`totalLimit`, `amountUsed`, `availableAmount`) doivent être positifs.
  - `availableAmount` doit être égal à `totalLimit` moins `amountUsed`.
- **Gestion des erreurs** :
  - Retourner 404 pour les ID ou numéros de carte invalides.
  - Retourner 400 pour les erreurs de validation.
- **Suppression en cascade** (optionnel) : Possibilité de supprimer un client et toutes ses cartes associées.
- **Suppression de tous les clients/cartes** : Ces opérations doivent être utilisées avec précaution et peuvent nécessiter une confirmation supplémentaire.

Ces modifications assurent que les opérations CRUD et les contraintes d'intégrité correspondent exactement aux classes Customer et Card définies, ainsi qu'aux scénarios de test fournis dans le cahier des charges.
